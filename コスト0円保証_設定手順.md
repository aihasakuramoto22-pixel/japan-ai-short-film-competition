# 💰 コスト0円保証 - 今すぐ実行する設定（10分）

**目的:** 無料枠を絶対に超えないようにして、**永久に0円運用**を保証する

---

## ⚡ 必須設定（3つ）

### 設定1: Cloudflare Pages自動デプロイ無効化（5分）⭐⭐⭐

#### なぜ必要？
- 毎回GitHubプッシュで自動デプロイされると、ビルド時間を消費
- 月500分制限 → 超過すると$0.10/分課金
- 手動デプロイのみにすれば、完全にコントロール可能

#### 手順

1. https://dash.cloudflare.com/ にログイン

2. 左メニュー → **Workers & Pages**

3. プロジェクト **jaisfc** をクリック

4. 上部タブ → **Settings**

5. 左サイドバー → **Builds & deployments**

6. **「Auto deployments」** セクションを見つける

7. **「Pause automatic builds」** ボタンをクリック

8. 確認ダイアログで **「Pause」** をクリック

#### 完了確認

「Automatic builds are paused」と表示されればOK ✅

#### これで何が変わる？

**変更前:**
```
GitHubにプッシュ → 自動でビルド → 自動でデプロイ
（ビルド時間を消費）
```

**変更後:**
```
GitHubにプッシュ → 何も起こらない
手動でデプロイボタンを押した時だけ → ビルド → デプロイ
（完全にコントロール可能！）
```

#### 今後のデプロイ方法

```bash
# コード変更
cd C:\Users\user\Desktop\jaisfc2
git add .
git commit -m "変更内容"
git push origin main
```

**ここまでは同じ！自動デプロイされない**

デプロイしたい時だけ:

1. https://dash.cloudflare.com/
2. Workers & Pages → jaisfc
3. **「Create deployment」** ボタンをクリック
4. **「Deploy now」** をクリック

---

### 設定2: R2ストレージ監視（手動）⭐⭐

#### なぜ必要？
- 無料枠: 10GB
- 超過すると$0.015/GB/月課金
- 大きな動画がアップロードされると容量を圧迫

#### 手順（月1回実行）

1. https://dash.cloudflare.com/ にログイン

2. 左メニュー → **R2**

3. バケット **japan-ai-film-competition** をクリック

4. 右上に使用量が表示される:
   ```
   例: 6.5 GB used of 10 GB
   ```

#### 安全基準

| 使用量 | ステータス | 対応 |
|-------|-----------|------|
| 0-7GB | ✅ 安全 | 何もしない |
| 7-9GB | 🟡 注意 | 古い動画を1-2本削除 |
| 9-10GB | 🔴 危険 | すぐに2-3本削除 |

#### 動画の削除方法

1. R2ダッシュボード → バケット **japan-ai-film-competition**
2. ファイル一覧を確認
3. 古い動画ファイル（日付が古い）を選択
4. **Delete** をクリック
5. 確認ダイアログで **Delete** をクリック

**目標:** 常に8GB以下を維持

---

### 設定3: Renderスリープ（自動）⭐

#### なぜ必要？
- 無料枠: 750時間/月
- 1ヶ月 = 744時間（31日 × 24時間）
- 自動的に750時間で停止（課金されない）

#### 手順

**何もする必要なし！** ✅

- RenderはUptimeRobotで24/7監視済み
- 月744時間稼働 < 750時間制限
- 自動停止機能があるため、超過時も課金されない

#### 確認方法（オプション）

1. https://dashboard.render.com/
2. **japan-ai-backend** サービスをクリック
3. **Metrics** タブ
4. グラフで稼働時間を確認

---

## ✅ 設定完了チェック

すべて完了したか確認:

- [ ] Cloudflare Pages自動デプロイ無効化（Paused）
- [ ] R2ストレージ使用量を確認（< 8GB）
- [ ] Renderは自動管理（何もしない）

**すべてチェックできたら完了！** 🎉

---

## 📅 定期チェック（カレンダーに登録推奨）

### 毎月1日（月次チェック）

**所要時間:** 5分

#### チェック項目

1. **R2ストレージ使用量**
   ```
   https://dash.cloudflare.com/ → R2 → japan-ai-film-competition
   → 使用量を確認（8GB以下を維持）
   ```

2. **Cloudflare Pagesビルド時間**
   ```
   https://dash.cloudflare.com/ → Workers & Pages → jaisfc → Analytics
   → Build time を確認（500分以下）
   ```

3. **Renderは自動管理**
   - 確認不要（自動停止機能あり）

#### 記録テンプレート

```
2025年10月 無料枠チェック

R2ストレージ: 6.5 GB / 10 GB ✅
Cloudflare Pages: 45分 / 500分 ✅
Render: 744時間 / 750時間 ✅

総コスト: 0円 ✅
```

---

## 🚨 警告アラートが出たら

### R2が8GB超えた

**症状:**
- ストレージ使用量が8-10GB

**対応（5分）:**

1. 古い動画を1-2本削除（上記手順）
2. 使用量が7GB以下になるまで削除
3. 完了

---

### Cloudflare Pagesビルドが400分超えた

**症状:**
- ビルド時間が400-500分

**対応:**

1. 今月はデプロイしない
2. 月初（翌月1日）にリセットされる
3. 完了

**回避策:**
- まとめてデプロイ（複数の変更を1回で）
- 月5-10回程度のデプロイに抑える

---

## 📊 コスト試算（最悪ケース）

**仮に無料枠を超えた場合:**

### ケース1: R2が15GB（5GB超過）
```
超過分: 5 GB
コスト: 5 × $0.015 = $0.075/月 (約10円)
```

### ケース2: Pagesビルドが600分（100分超過）
```
超過分: 100分
コスト: 100 × $0.10 = $10 (約1,500円)
```

**でも安心してください！**
- 上記の設定で、これらは**絶対に発生しません** ✅

---

## 🎯 推奨運用フロー

### 日常の開発

```bash
# ローカルで開発
cd C:\Users\user\Desktop\jaisfc2

# コード変更
# ファイル編集...

# GitHubにプッシュ
git add .
git commit -m "機能追加"
git push origin main

# ここで自動デプロイされない（Pausedにしたので）
```

### デプロイしたい時

1. https://dash.cloudflare.com/
2. Workers & Pages → jaisfc
3. **Deployments** タブ
4. **Create deployment** → **Deploy now**
5. 3-5分待つ
6. 完了 ✅

**頻度:** 週1回、または重要な変更時のみ

---

### 本番運用中

**デプロイ頻度:**
- 応募開始前: 週2-3回（テスト、修正）
- 応募期間中: 月1-2回（緊急時のみ）
- 応募終了後: デプロイ不要

**これで年間ビルド時間:**
```
開発期間: 2ヶ月 × 10回/月 × 5分 = 100分
運用期間: 3ヶ月 × 2回/月 × 5分 = 30分
合計: 130分 << 500分/月

→ 完全に無料枠内！ ✅
```

---

## 💡 さらなるコスト削減Tips

### Tip1: まとめてデプロイ

**悪い例:**
```bash
git commit -m "ボタン修正"
git push  # デプロイ1回

git commit -m "色変更"
git push  # デプロイ1回

git commit -m "文言修正"
git push  # デプロイ1回

# 合計: 3回のビルド = 15分消費
```

**良い例:**
```bash
# すべての変更をまとめて
git commit -m "UI改善: ボタン、色、文言修正"
git push

# Cloudflareで手動デプロイ1回だけ
# 合計: 1回のビルド = 5分消費
```

---

### Tip2: ローカルでテスト

デプロイ前に必ずローカルでテスト:

```bash
# ローカルサーバー起動
npm run dev

# ブラウザで確認
http://localhost:3000

# 問題なければデプロイ
```

これで無駄なデプロイを防げます。

---

### Tip3: Productionブランチ戦略

**上級者向け:**

```bash
# 通常の開発 → mainブランチ
git checkout main
git commit -m "開発中"
git push origin main
# 自動デプロイされない

# 本番リリース → productionブランチ
git checkout production
git merge main
git push origin production
# これだけ自動デプロイ
```

Cloudflare Pagesの設定:
```
Production branch: production （mainから変更）
```

---

## 🎊 完了！

### 設定後の状態

✅ Cloudflare Pages: 手動デプロイのみ
✅ R2ストレージ: 月1回チェック
✅ Render: 自動管理（何もしない）

### これで保証されること

**総運用コスト: 0円/月** が**永久に**維持されます！

### やることリスト

**今すぐ:**
- [ ] Cloudflare Pages自動デプロイ無効化

**月1回（1日）:**
- [ ] R2ストレージチェック
- [ ] Cloudflare Pagesビルド時間チェック

**それだけ！** 🎉

---

## 📞 Q&A

### Q: 自動デプロイを無効にすると不便では？

**A:** いいえ、むしろ安全です！
- 意図しないデプロイを防げる
- ビルド時間を完全にコントロール
- 本番環境をより慎重に管理できる

---

### Q: 750時間を超えるとどうなる？

**A:** Renderが自動停止します。
- 課金は一切されません ✅
- でも、24/7稼働でも744時間なので超えません
- 心配無用です！

---

### Q: R2が10GB超えたらすぐ課金される？

**A:** はい、即座に課金されます。
- だから8GB以下を維持することが重要
- 月1回チェックすれば十分防げます
- 1本の動画 = 約500MB → 20本まで安全

---

### Q: 手動チェックが面倒...

**A:** 月1回5分だけです！
- カレンダーアプリでリマインダー設定
- 毎月1日に「JAISFC チェック」
- 習慣になれば簡単です

---

## 🎯 まとめ

### 設定完了すれば...

1. **Cloudflare Pages** → 手動デプロイのみ（完全コントロール）
2. **R2ストレージ** → 月1回5分チェック
3. **Render** → 自動管理（何もしない）

### 結果

**総運用コスト: 0円/月** が**永久保証**！ 🎉

---

**作成日:** 2025年10月20日
**所要時間:** 10分
**効果:** 永久無料運用

© 2025 Japan AI Short Film Competition. All rights reserved.
